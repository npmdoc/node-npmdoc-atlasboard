<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://atlasboard.bitbucket.org"

    >atlasboard (v1.1.3)</a>
</h1>
<h4>AtlasBoard is dashboard/wallboard framework written all in JS</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard">module atlasboard</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.atlasboard">
            function <span class="apidocSignatureSpan"></span>atlasboard
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.event_queue">
            function <span class="apidocSignatureSpan">atlasboard.</span>event_queue
            <span class="apidocSignatureSpan">(io)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.scheduler">
            function <span class="apidocSignatureSpan">atlasboard.</span>scheduler
            <span class="apidocSignatureSpan">(jobWorker)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.storage_base">
            function <span class="apidocSignatureSpan">atlasboard.</span>storage_base
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>commands_logic</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>dashboard</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>default</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>event_queue.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>hipchat</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>item_manager</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>job_initialiser</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>job_manager</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>loader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>logic</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>package_dependency_manager</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>path_resolver</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>scaffolding</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>scheduler.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>storage_base.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>stylus</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>template_manager</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">atlasboard.</span>widget</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.commands_logic">module atlasboard.commands_logic</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.commands_logic.generate">
            function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>generate
            <span class="apidocSignatureSpan">(projectDir, package, itemType, itemName, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.commands_logic.install">
            function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>install
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.commands_logic.list">
            function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>list
            <span class="apidocSignatureSpan">(packagesPath, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.commands_logic.newProject">
            function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>newProject
            <span class="apidocSignatureSpan">(srcDir, destDir, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.commands_logic.start">
            function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>start
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.dashboard">module atlasboard.dashboard</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.dashboard.listAllDashboards">
            function <span class="apidocSignatureSpan">atlasboard.dashboard.</span>listAllDashboards
            <span class="apidocSignatureSpan">(packagesPath, req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.dashboard.renderDashboard">
            function <span class="apidocSignatureSpan">atlasboard.dashboard.</span>renderDashboard
            <span class="apidocSignatureSpan">(packagesPath, dashboardName, req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.default">module atlasboard.default</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.default.onInit">
            function <span class="apidocSignatureSpan">atlasboard.default.</span>onInit
            <span class="apidocSignatureSpan">(config, dependencies)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.default.onRun">
            function <span class="apidocSignatureSpan">atlasboard.default.</span>onRun
            <span class="apidocSignatureSpan">(config, dependencies, jobCallback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.event_queue">module atlasboard.event_queue</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.event_queue.event_queue">
            function <span class="apidocSignatureSpan">atlasboard.</span>event_queue
            <span class="apidocSignatureSpan">(io)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.event_queue.prototype">module atlasboard.event_queue.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.event_queue.prototype.send">
            function <span class="apidocSignatureSpan">atlasboard.event_queue.prototype.</span>send
            <span class="apidocSignatureSpan">(id, data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.helpers">module atlasboard.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.helpers.areValidPathElements">
            function <span class="apidocSignatureSpan">atlasboard.helpers.</span>areValidPathElements
            <span class="apidocSignatureSpan">(paths)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.helpers.getJSONFromFile">
            function <span class="apidocSignatureSpan">atlasboard.helpers.</span>getJSONFromFile
            <span class="apidocSignatureSpan">(path, defaultValue, warnIfFileNotExists, warnIfFileIsInvalid)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.helpers.getRndInt">
            function <span class="apidocSignatureSpan">atlasboard.helpers.</span>getRndInt
            <span class="apidocSignatureSpan">(min, max)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.helpers.isPathContainedInRoot">
            function <span class="apidocSignatureSpan">atlasboard.helpers.</span>isPathContainedInRoot
            <span class="apidocSignatureSpan">(pathDir, root)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.helpers.readJSONFile">
            function <span class="apidocSignatureSpan">atlasboard.helpers.</span>readJSONFile
            <span class="apidocSignatureSpan">(dashboardPath, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.hipchat">module atlasboard.hipchat</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.hipchat.create">
            function <span class="apidocSignatureSpan">atlasboard.hipchat.</span>create
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.item_manager">module atlasboard.item_manager</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.item_manager.get">
            function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>get
            <span class="apidocSignatureSpan">(packagesPath, itemType, extension, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.item_manager.getByPackage">
            function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>getByPackage
            <span class="apidocSignatureSpan">(packagesPath, itemType, extension, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.item_manager.getFirst">
            function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>getFirst
            <span class="apidocSignatureSpan">(packagesPath, itemName, itemType, extension, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.item_manager.resolveCandidates">
            function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>resolveCandidates
            <span class="apidocSignatureSpan">(items, name, itemType, extension)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.item_manager.resolveLocation">
            function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>resolveLocation
            <span class="apidocSignatureSpan">(name, itemType, extension)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.job_initialiser">module atlasboard.job_initialiser</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.job_initialiser.init">
            function <span class="apidocSignatureSpan">atlasboard.job_initialiser.</span>init
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.job_manager">module atlasboard.job_manager</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.job_manager.getJobs">
            function <span class="apidocSignatureSpan">atlasboard.job_manager.</span>getJobs
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.loader">module atlasboard.loader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.loader.fillDependencies">
            function <span class="apidocSignatureSpan">atlasboard.loader.</span>fillDependencies
            <span class="apidocSignatureSpan">(jobWorker, deps)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.logic">module atlasboard.logic</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.logic.log">
            function <span class="apidocSignatureSpan">atlasboard.logic.</span>log
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.logic.renderJsDashboard">
            function <span class="apidocSignatureSpan">atlasboard.logic.</span>renderJsDashboard
            <span class="apidocSignatureSpan">(packagesPath, wallboardAssetsFolder, dashboardName, req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.package_dependency_manager">module atlasboard.package_dependency_manager</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.package_dependency_manager.installDependencies">
            function <span class="apidocSignatureSpan">atlasboard.package_dependency_manager.</span>installDependencies
            <span class="apidocSignatureSpan">(packagesPath, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.path_resolver">module atlasboard.path_resolver</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.path_resolver.fromAtlasboard">
            function <span class="apidocSignatureSpan">atlasboard.path_resolver.</span>fromAtlasboard
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.path_resolver.fromLocalWallboard">
            function <span class="apidocSignatureSpan">atlasboard.path_resolver.</span>fromLocalWallboard
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.scaffolding">module atlasboard.scaffolding</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.scaffolding.scaffold">
            function <span class="apidocSignatureSpan">atlasboard.scaffolding.</span>scaffold
            <span class="apidocSignatureSpan">(templateSourceFolder, destinationFolder, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.scheduler">module atlasboard.scheduler</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.scheduler.scheduler">
            function <span class="apidocSignatureSpan">atlasboard.</span>scheduler
            <span class="apidocSignatureSpan">(jobWorker)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.scheduler.prototype">module atlasboard.scheduler.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.scheduler.prototype.scheduleNext">
            function <span class="apidocSignatureSpan">atlasboard.scheduler.prototype.</span>scheduleNext
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.scheduler.prototype.start">
            function <span class="apidocSignatureSpan">atlasboard.scheduler.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.storage_base">module atlasboard.storage_base</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.storage_base.storage_base">
            function <span class="apidocSignatureSpan">atlasboard.</span>storage_base
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.storage_base.prototype">module atlasboard.storage_base.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.storage_base.prototype.get">
            function <span class="apidocSignatureSpan">atlasboard.storage_base.prototype.</span>get
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.storage_base.prototype.set">
            function <span class="apidocSignatureSpan">atlasboard.storage_base.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.stylus">module atlasboard.stylus</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.stylus.getMiddleware">
            function <span class="apidocSignatureSpan">atlasboard.stylus.</span>getMiddleware
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.stylus.getWidgetCSS">
            function <span class="apidocSignatureSpan">atlasboard.stylus.</span>getWidgetCSS
            <span class="apidocSignatureSpan">(str, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.template_manager">module atlasboard.template_manager</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.template_manager.resolveTemplateLocation">
            function <span class="apidocSignatureSpan">atlasboard.template_manager.</span>resolveTemplateLocation
            <span class="apidocSignatureSpan">(fileName, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.atlasboard.widget">module atlasboard.widget</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.widget._addNamespace">
            function <span class="apidocSignatureSpan">atlasboard.widget.</span>_addNamespace
            <span class="apidocSignatureSpan">(css, res, widgetNamespace)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.widget.log">
            function <span class="apidocSignatureSpan">atlasboard.widget.</span>log
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.widget.renderHtmlWidget">
            function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderHtmlWidget
            <span class="apidocSignatureSpan">(packagesPath, widgetName, req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.widget.renderJsWidget">
            function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderJsWidget
            <span class="apidocSignatureSpan">(packagesPath, widgetName, req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.atlasboard.widget.renderWidgetResource">
            function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderWidgetResource
            <span class="apidocSignatureSpan">(localPackagesPath, resource, req, res)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard" id="apidoc.module.atlasboard">module atlasboard</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.atlasboard" id="apidoc.element.atlasboard.atlasboard">
        function <span class="apidocSignatureSpan"></span>atlasboard
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">atlasboard = function (options, callback) {

  options = options || {};

  var packagesLocalFolder = path.join(process.cwd(), &#x22;/packages&#x22;);
  var packagesAtlasboardFolder = path.join(__dirname, &#x22;../packages&#x22;);

  var configPath = path.join(process.cwd(), &#x22;/config&#x22;);

  var runner = function (cb) {

    //-----------------------------------
    // Init web server
    //-----------------------------------

    var app = express();
    var httpServer = webServer(app, {
      port: options.port,
      packageLocations: [packagesLocalFolder, packagesAtlasboardFolder]
    });

    console.log(&#x27;\n-------------------------------------------&#x27;.yellow);
    console.log((&#x27;Atlasboard listening at port &#x27; + options.port).gray);
    console.log(&#x27;-------------------------------------------&#x27;.yellow + &#x27;\n&#x27;);

    //-----------------------------------
    // Init socket.io server
    //-----------------------------------

    var io = socketIO.listen(httpServer, {
      &#x27;log level&#x27;: 2
    });
    var startTime = new Date().getTime();
    io.on(&#x27;connection&#x27;, function (socket) {
      socket.emit(&#x22;serverinfo&#x22;, {startTime: startTime});
    });

    //-----------------------------------
    // Init jobs / scheduler
    //-----------------------------------

    var jobOptions = {
      packagesPath: [packagesLocalFolder, packagesAtlasboardFolder],
      configPath: configPath,
      filters: options.filters,
      deps: {io: io, app: app}
    };

    jobInitialiser.init(jobOptions, cb);
  };

  if (options.install) {
    console.log(&#x27;Installing dependencies...&#x27;.gray);
    packageDependencyManager.installDependencies([packagesLocalFolder], function (err) {
      if (err) {
        return callback(err);
      }
      console.log(&#x27;done!&#x27;.green);
      runner(callback);
    });
  } else {
    runner(callback);
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.event_queue" id="apidoc.element.atlasboard.event_queue">
        function <span class="apidocSignatureSpan">atlasboard.</span>event_queue
        <span class="apidocSignatureSpan">(io)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventQueue(io) {
  this.io = io;
  this.latestEvents = {};
  var self = this;

  io.on(&#x22;connection&#x22;, function (socket) {
    socket.on(&#x22;resend&#x22;, function (data) {
      if (self.latestEvents[data]) {
        socket.emit(data, self.latestEvents[data]);
      }
    });

    // broadcast logs
    socket.on(&#x22;log&#x22;, function (data) {
      socket.broadcast.emit(&#x27;client&#x27;, data);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.scheduler" id="apidoc.element.atlasboard.scheduler">
        function <span class="apidocSignatureSpan">atlasboard.</span>scheduler
        <span class="apidocSignatureSpan">(jobWorker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Scheduler(jobWorker) {
  this.jobWorker = ensureSafeJobWorkerConfiguration(jobWorker);
  this.originalInterval = jobWorker.config.interval;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.storage_base" id="apidoc.element.atlasboard.storage_base">
        function <span class="apidocSignatureSpan">atlasboard.</span>storage_base
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StorageBase(){ }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.commands_logic" id="apidoc.module.atlasboard.commands_logic">module atlasboard.commands_logic</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.commands_logic.generate" id="apidoc.element.atlasboard.commands_logic.generate">
        function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>generate
        <span class="apidocSignatureSpan">(projectDir, package, itemType, itemName, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generate = function (projectDir, package, itemType, itemName, callback){

  if (!helpers.areValidPathElements([itemType, itemName])){
    return callback(&#x27;invalid input&#x27;);
  }

  var templateFolder = path.join(__dirname, &#x22;../..&#x22;, &#x22;templates&#x22;, &#x22;new-components&#x22;);

  //Assert valid parameter usage
  var itemsToGenerate = [&#x22;widget&#x22;, &#x22;dashboard&#x22;, &#x22;job&#x22;];
  if (itemsToGenerate.indexOf(itemType) == -1) {
    return callback(&#x22;Invalid generator &#x22; + itemType + &#x22;\nUse one of: &#x22; + itemsToGenerate.join(&#x22;, &#x22;));
  }

  //Assert a project already exists here
  if (!directoryHasAtlasBoardProject(projectDir)){
    return callback(&#x22;It seems that no project exists here yet. Please navigate to your project&#x27;s root directory, or generate one
 first.&#x22;);
  }

  //Assert name given
  if (!itemName) {
    return callback(&#x22;ERROR: No &#x22; + itemType + &#x22; name provided. Please try again with a name after the generate parameter&#x22;);
  }

  //Assert no such item exists there yet
  var destPackageLocation = path.join(projectDir, &#x22;packages&#x22;, package);

  var options = {};
  var target, src;

  if (itemType === &#x27;dashboard&#x27;){ // all dashboards files are stored within the dashboards folder
    src = path.join(templateFolder, &#x27;dashboard&#x27;, &#x27;default.json&#x27;);
    target = path.join(destPackageLocation, &#x27;dashboards&#x27;, itemName + &#x27;.json&#x27;);
  }
  else {

    src = path.join(templateFolder, itemType);
    target = path.join(path.join(destPackageLocation, itemType + &#x22;s&#x22;), itemName);

    options = {
      engine : &#x27;ejs&#x27;,
      data : {
        name: itemName
      },
      replace: {
        &#x22;widget.&#x22;: itemName + &#x27;.&#x27;,
        &#x22;default.js&#x22;: itemName + &#x27;.js&#x27;
       }
    };
  }

  if (fs.existsSync(target)) {
    return callback (&#x22;ERROR: This &#x22; + itemType + &#x22; already seems to exist at &#x22; + target);
  }

  console.log(&#x22;\nCreating new %s at %s...&#x22;, itemType, target);
  scaffolding.scaffold(src, target, options, callback);
  console.log(&#x22;SUCCESS !!&#x22;.green + &#x27;\n&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
beforeEach(function(done){
  fs.mkdir(tempFolder, function(){
    commandLogic.newProject(PROJECT_TEMPLATE_PATH, projectPath, done);
  });
});

it(&#x27;should return error if bad resource type provided&#x27;, function(done){
  commandLogic.<span class="apidocCodeKeywordSpan">generate</span>(&#x22;/ba/ddir&#x22;, &#x22;default&#x22;, &#x22;widgettt&#x22
;, &#x22;mywidget&#x22;, function(err){
    assert.ok(err.indexOf(&#x22;Invalid generator&#x22;)&#x3e;-1, err);
    done();
  });
});

it(&#x27;should return error if no project exists in the provided path&#x27;, function(done){
  commandLogic.generate(&#x22;/b/addir&#x22;, &#x22;default&#x22;, &#x22;widget&#x22;, &#x22;mywidget&#x22;, function(err){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.commands_logic.install" id="apidoc.element.atlasboard.commands_logic.install">
        function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>install
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">install = function (options, callback) {
  var packagesLocalFolder = path.join(process.cwd(), &#x22;/packages&#x22;);
  packageDependencyManager.installDependencies([packagesLocalFolder], callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  install: {

    descr: &#x22;install package dependencies&#x22;,
    example: &#x22;atlasboard install&#x22;,

    run: function (args, cb) { // check for the right arguments
           return logicCli.<span class="apidocCodeKeywordSpan">install</span>({}, function(err){
             cb &#x26;&#x26; cb(err);
           });
    }
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.commands_logic.list" id="apidoc.element.atlasboard.commands_logic.list">
        function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>list
        <span class="apidocSignatureSpan">(packagesPath, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">list = function (packagesPath, callback){
  packagesPath = Array.isArray(packagesPath) ? packagesPath : [packagesPath];
  async.map(_.unique(packagesPath), function(packagePath, cb){
    var list = { package : packagePath};
    itemManager.getByPackage(packagePath, &#x22;widgets&#x22;, &#x22;.js&#x22;, function(err, packagesWidgetList){
      if (err) {return cb(err);}
      list.widgets = packagesWidgetList;
      itemManager.getByPackage(packagePath, &#x22;jobs&#x22;, &#x22;.js&#x22;, function(err, packagesJobList){
        if (err) {return cb(err);}
        list.jobs = packagesJobList;
        cb(null, (list.widgets.length &#x26;&#x26; list.jobs.length) ? list : null);
      });
    });
  }, function (err, results){
    callback(err, _.compact(results));
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      });
    });

  });

  describe (&#x27;list&#x27;, function(){
    it(&#x27;should list available components&#x27;, function(done){
      commandLogic.<span class="apidocCodeKeywordSpan">list</span>(packagesLocalFolder, function(err, lists){

assert.ok(Array.isArray(lists));
assert.equal(lists.length, 1);
assert.equal(lists[0].package, packagesLocalFolder);

assert.equal(lists[0].widgets.length, 2);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.commands_logic.newProject" id="apidoc.element.atlasboard.commands_logic.newProject">
        function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>newProject
        <span class="apidocSignatureSpan">(srcDir, destDir, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">newProject = function (srcDir, destDir, callback) {

  //check for valid directory name
  var dirName = path.basename(destDir);
  if (!dirName.match(validNewDirectoryExp)){
    return callback(&#x27;Invalid wallboard name&#x27;);
  }

  if (!helpers.isPathContainedInRoot(destDir, process.cwd())){
    return callback(&#x27;invalid directory&#x27;);
  }

  console.log(&#x22;\n  Generating a new AtlasBoard project at %s...&#x22;, destDir.gray);

  var parentDir = path.dirname(destDir);

  if (directoryHasAtlasBoardProject(parentDir)){
    return callback(&#x22;You can not create an atlasboard inside a directory containing an atlasboard (at least we think you shouldn
&#x27;t)&#x22;);
  }

  if (fs.existsSync(destDir)) {
    return callback(&#x22;There is already a directory here called &#x22; + destDir + &#x22;. Please choose a new name.&#x22;);
  }

  console.log(&#x22;  Creating new wallboard ...&#x22;);
  var options = {
    engine : &#x27;ejs&#x27;,
    data : {
      name : dirName
    }
  };
  scaffolding.scaffold(srcDir, destDir, options, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  afterEach(cleanup);

  describe (&#x27;new&#x27;, function(){

it(&#x27;should create a new project ok&#x27;, function(done){
  var projectPath = path.join(tempFolder, &#x27;test&#x27;);
  commandLogic.<span class="apidocCodeKeywordSpan">newProject</span>(PROJECT_TEMPLATE_PATH, projectPath, function(err){
    assert.ifError(err);
    assert.ok(fs.existsSync(path.join(projectPath, &#x22;package.json&#x22;)), &#x27;missing package.json in new generated project
: &#x27; + projectPath);
    assert.ok(fs.existsSync(path.join(projectPath, &#x22;globalAuth.json&#x22;)), &#x27;missing globalAuth.json in new generated
 project: &#x27; + projectPath);
    assert.ok(fs.existsSync(path.join(projectPath, &#x22;assets&#x22;)), &#x27;missing assets folder in new generated project: &#
x27; + projectPath);
    assert.ok(fs.existsSync(path.join(projectPath, &#x22;packages&#x22;)), &#x27;missing packages in new generated project:&#x27
;  + projectPath);
    assert.ok(fs.existsSync(path.join(projectPath, &#x22;packages&#x22;, &#x22;demo&#x22;, &#x22;dashboards&#x22;)), &#x27;missing
 packages in new generated project: &#x27;  + projectPath);
    assertFileContains(path.join(projectPath, &#x22;README.md&#x22;), &#x22;# test, my awesome&#x22;, done); // templating works
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.commands_logic.start" id="apidoc.element.atlasboard.commands_logic.start">
        function <span class="apidocSignatureSpan">atlasboard.commands_logic.</span>start
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (options, callback){
  if (!directoryHasAtlasBoardProject(process.cwd())){
    return callback(&#x22;I couldn&#x27;t find a valid AtlasBoard dashboard. Try generating one with `atlasboard new DASHBOARDNAME`.&#x22;);
  }

  // start AtlasBoard
  atlasboard(options, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if (jobWorker.onInit) {
    jobWorker.onInit.call(jobWorker, jobWorker.config, jobWorker.dependencies);
  }

  if (jobWorker.onRun) {
    setTimeout(function () {
      var scheduler = new Scheduler(jobWorker);
      scheduler.<span class="apidocCodeKeywordSpan">start</span>();
    }, index * 1500); // avoid a concurrency peak on startup
  }
}
else { // job is disabled
  jobWorker.pushUpdate({error: &#x27;disabled&#x27;});
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.dashboard" id="apidoc.module.atlasboard.dashboard">module atlasboard.dashboard</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.dashboard.listAllDashboards" id="apidoc.element.atlasboard.dashboard.listAllDashboards">
        function <span class="apidocSignatureSpan">atlasboard.dashboard.</span>listAllDashboards
        <span class="apidocSignatureSpan">(packagesPath, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listAllDashboards = function (packagesPath, req, res) {
  itemManager.get(packagesPath, &#x22;dashboards&#x22;, &#x22;.json&#x22;, function (err, dashboardConfigFiles) {
    if (err) {
      logger.error(err);
      return res.status(400).send(&#x22;Error loading dashboards&#x22;);
    }
    if (dashboardConfigFiles.length === 1) {
      return res.redirect(&#x22;/&#x22; + getSafeItemName(dashboardConfigFiles[0]));
    } else {
      async.map(dashboardConfigFiles, readDashboardJSON, function (err, dashboardJSONs) {
        if (err) {
          return res.status(500).send(&#x22;Error reading dashboards&#x22;);
        }
        templateManager.resolveTemplateLocation(&#x27;dashboard-list.ejs&#x27;, function (err, location) {
          res.render(location, {
            dashboards: dashboardJSONs.sort(function (a, b) {
              if ( a.friendlyDashboardName &#x3c; b.friendlyDashboardName )
                return -1;
              if ( a.friendlyDashboardName &#x3e; b.friendlyDashboardName )
                return 1;
              return 0;
            })
          });
        });
      });
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      assert.equal(data.dashboards[0].friendlyDashboardName, &#x27;A custom title for test_dashboard1&#x27;);
      assert.equal(data.dashboards[1].friendlyDashboardName, &#x27;other test dashboard1&#x27;);
      assert.equal(data.dashboards[2].friendlyDashboardName, &#x27;other test dashboards2&#x27;);
      assert.equal(data.dashboards[3].friendlyDashboardName, &#x27;test dashboard2&#x27;);
      done();
    }
  };
  widgetRouteDashboard.<span class="apidocCodeKeywordSpan">listAllDashboards</span>([packagesLocalFolder, packagesAtlasboardFolder
], {}, res);
});

it(&#x27;redirects to dashboard page if we only have one&#x27;, function (done) {
  var res = {
    redirect: function (data) {
      assert.equal(data, &#x22;/mydashboard&#x22;);
      done();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.dashboard.renderDashboard" id="apidoc.element.atlasboard.dashboard.renderDashboard">
        function <span class="apidocSignatureSpan">atlasboard.dashboard.</span>renderDashboard
        <span class="apidocSignatureSpan">(packagesPath, dashboardName, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderDashboard = function (packagesPath, dashboardName, req, res) {
  dashboardName = getSafeItemName(dashboardName);
  itemManager.getFirst(packagesPath, dashboardName, &#x22;dashboards&#x22;, &#x22;.json&#x22;, function (err, dashboardPath) {
    if (err || !dashboardPath) {
      var statusCode = err ? 400 : 404;
      return res.status(statusCode).send(err ? err : &#x22;Trying to render the dashboard &#x27;&#x22; +
      dashboardName + &#x22;&#x27;, but couldn&#x27;t find a valid dashboard with that name. &#x22; +
      &#x22;If the dashboard exists, is it a valid json file? Please check the console for error messages&#x22;);
    }
    helpers.readJSONFile(dashboardPath, function (err, dashboardJSON) {
      if (err) {
        return res.status(400).send(&#x22;Invalid dashboard config file&#x22;);
      }
      templateManager.resolveTemplateLocation(&#x22;dashboard.ejs&#x22;, function (err, location) {
        res.render(location, {
          dashboardName: dashboardName,
          dashboardConfig: dashboardJSON
        });
      });
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      assert.ok(data.dashboardConfig);
      done();
    },
    send: function () {
      done(&#x22;Not expected&#x22;);
    }
  };
  widgetRouteDashboard.<span class="apidocCodeKeywordSpan">renderDashboard</span>([packagesLocalFolder, packagesAtlasboardFolder
], &#x22;test_dashboard1&#x22;, {}, res);
});


it(&#x27;returns 404 if there is a dashboard with an invalid format&#x27;, function (done) {
  widgetRouteDashboard.renderDashboard([packagesLocalFolder, packagesAtlasboardFolder, packagesWithInvalidDashboardFile], &#x22;
invalid_json_file&#x22;,
      {}, responseHelpers.getResponseForSendStatusCode(404, done));
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.default" id="apidoc.module.atlasboard.default">module atlasboard.default</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.default.onInit" id="apidoc.element.atlasboard.default.onInit">
        function <span class="apidocSignatureSpan">atlasboard.default.</span>onInit
        <span class="apidocSignatureSpan">(config, dependencies)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onInit = function (config, dependencies) {

<span class="apidocCodeCommentSpan">  /*
  This is a good place for initialisation logic, like registering routes in express:

  dependencies.logger.info(&#x27;adding routes...&#x27;);
  dependencies.app.route(&#x22;/jobs/mycustomroute&#x22;)
      .get(function (req, res) {
        res.end(&#x27;So something useful here&#x27;);
      });
  */
</span>}</pre></li>
    <li>example usage<pre class="apidocCodePre">...







var atlasboard=atlasboard||{};atlasboard.triggerEvent=function(){var e=$(&#x22;#widgets-container&#x22;);e.trigger.apply(e,arguments
)},atlasboard.on=function(){var e=$(&#x22;#widgets-container&#x22;);e.on.apply(e,arguments)},$(function(){function logError(e,t){
var n=&#x22;ERROR on &#x22;+e.eventId+&#x22;: &#x22;+t;console.error(n),socket.emit(&#x22;log&#x22;,{widgetId:e.eventId,error:n})}
function wrapFn(e,t,n){return function(){t.apply(e,arguments),n.apply(e,arguments)}}function extendWrapping(e,t){for(var n in t)
e[n]?e[n]=wrapFn(e,e[n],t[n]):e[n]=t[n];return e}function bindWidget(io,$li){var widgetId=encodeURIComponent($li.attr(&#x22;data
-widget-id&#x22;)),eventId=$li.attr(&#x22;data-event-id&#x22;),$widgetContainer=$(&#x22;&#x3c;div&#x3e;&#x22;).addClass(&#x22;widget
-container&#x22;).appendTo($li).hide(),$errorContainer=$(&#x22;&#x3c;div&#x3e;&#x22;).addClass(&#x22;widget-error&#x22;).appendTo
($li).hide();$widgetContainer.load(&#x22;/widgets/&#x22;+widgetId,function(){$.get(&#x22;/widgets/&#x22;+widgetId+&#x22;/js&#x22
;,function(js){var widgetJS={};try{eval(&#x22;widgetJS = &#x22;+js),widgetJS.eventId=eventId,widgetJS=extendWrapping(widgetJS,widgetDefaultHandlers
),widgetJS.<span class="apidocCodeKeywordSpan">onInit</span>($widgetContainer,widgetId)}catch(e){logError(widgetJS,e)}io.on(eventId
,function(e){e.error?widgetJS.onError.apply(widgetJS,[$errorContainer,e,widgetId]):($widgetContainer.is(&#x22;:visible&#x22;)||($
widgetContainer.siblings().fadeOut(500),$widgetContainer.fadeIn(500)),widgetJS.onData.apply(widgetJS,[$widgetContainer,e,widgetId
]))}),io.emit(&#x22;resend&#x22;,eventId)})})}var widgetDefaultHandlers={onInit:function(){atlasboard.triggerEvent(&#x22;widgetInit
&#x22;,{$widgetContainer:arguments[0],widgetId:arguments[1]})},onError:function(){atlasboard.triggerEvent(&#x22;widgetError&#x22
;,{$errorContainer:arguments[0],data:arguments[1],widgetId:arguments[2]})},onData:function(){atlasboard.triggerEvent(&#x22;widgetData
&#x22;,{$widgetContainer:arguments[0],data:arguments[1],widgetId:arguments[2]})},log:function(e){socket.emit(&#x22;log&#x22;,{widgetId
:this.eventId,data:e})}};$.ajaxSetup({cache:!1});var gridsterContainer=$(&#x22;.gridster ul&#x22;),serverInfo,socket=io.connect();
socket.on(&#x22;connect&#x22;,function(){atlasboard.triggerEvent(&#x22;socketConnected&#x22;,{socket:socket})}),socket.on(&#x22;
disconnect&#x22;,function(){atlasboard.triggerEvent(&#x22;socketDisconnected&#x22;,{socket:socket})}),socket.on(&#x22;reconnecting
&#x22;,function(){atlasboard.triggerEvent(&#x22;socketReconnecting&#x22;,{socket:socket})}),socket.on(&#x22;reconnect_failed&#x22
;,function(){atlasboard.triggerEvent(&#x22;socketReconnectFailed&#x22;,{socket:socket})}),socket.on(&#x22;serverinfo&#x22;,function
(e){serverInfo?e.startTime&#x3e;serverInfo.startTime&#x26;&#x26;window.location.reload():serverInfo=e}),gridsterContainer.children
(&#x22;li&#x22;).each(function(e,t){var n=$(t);n.empty(),bindWidget(socket,n)})});
!function(){function n(n){var t=.035,i=n.width(),o=i*t;$(&#x22;.content.auto-font-resize&#x22;,n).css({&#x22;font-size&#x22;:o+&#
x22;px&#x22;})}atlasboard.on(&#x22;widgetInit&#x22;,function(t,i){n(i.$widgetContainer)})}();
!function(){var i=$(&#x22;#main-container&#x22;),n=i.outerWidth(),t=i.outerHeight();$(window).resize(function(){var e=$(window).
width()/n,o=$(window).height()/t;i.css(&#x22;transform&#x22;,&#x22;scale(&#x22;+Math.min(e,o)+&#x22;)&#x22;)}).resize()}();
!function(){atlasboard.on(&#x22;socketConnected&#x22;,function(n){console.log(&#x22;connected&#x22;),$(&#x22;#main-container&#x22
;).removeClass(&#x22;disconnected&#x22;)}),atlasboard.on(&#x22;socketDisconnected&#x22;,function(n){$(&#x22;#main-container&#x22
;).addClass(&#x22;disconnected&#x22;),console.log(&#x22;disconnected&#x22;)}),atlasboard.on(&#x22;socketReconnectFailed&#x22;,function
(n){console.log(&#x22;reconnected FAILED&#x22;)}),atlasboard.on(&#x22;socketReconnecting&#x22;,function(n){console.log(&#x22;reconnecting
...&#x22;)})}();
!function(){atlasboard.on(&#x22;widgetError&#x22;,function(r,a){console.error(a.error||a);var s=a.$errorContainer;a.data&#x26;&#
x26;&#x22;disabled&#x22;===a.data.error?s.html(&#x27;&#x3c;span class=&#x22;disabled&#x22;&#x3e;DISABLED&#x3c;/span&#x3e;&#x27;):
s.html(&#x27;&#x3c;span class=&#x22;error&#x22;&#x3e;&#x26;#9888;&#x3c;/span&#x3e;&#x27;),s.is(&#x22;:visible&#x22;)||(s.siblings
().hide(),s.fadeIn())})}();
!function(){var i=$(&#x22;#main-container&#x22;),n=$(&#x22;.gridster ul&#x22;),s=2*parseInt(i.css(&#x22;paddingTop&#x22;),10),t=
s/2,e=1080-i.offset().top-t,d=i.width(),r=GRID_ROWS,a=GRID_COLUMNS,g={w:(d-a*s)/a,h:(e-r*s)/r};n.gridster({widget_margins:[t,t],
widget_base_dimensions:[g.w,g.h]})}();
!function(){atlasboard.on(&#x22;widgetInit&#x22;,function(n,e){var a=new Spinner({className:&#x22;spinner&#x22;,color:&#x22;#f5f5f5
&#x22;,width:5,length:15,radius:25,lines:12,speed:.7,shadow:!0}).spin();$(&#x22;&#x3c;div&#x3e;&#x22;).addClass(&#x22;spinner&#x22
;).append(a.el).appendTo(e.$widgetContainer.parent())}),atlasboard.on(&#x22;widgetData&#x22;,function(n,e){$(&#x22;.spinner&#x22
;,e.$widgetContainer.parent()).hide()}),atlasboard.on(&#x22;widgetError&#x22;,function(n,e){$(&#x22;.spinner&#x22;,e.$errorContainer
.parent()).hide()})}();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.default.onRun" id="apidoc.element.atlasboard.default.onRun">
        function <span class="apidocSignatureSpan">atlasboard.default.</span>onRun
        <span class="apidocSignatureSpan">(config, dependencies, jobCallback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onRun = function (config, dependencies, jobCallback) {

<span class="apidocCodeCommentSpan">  /*
   1. USE OF JOB DEPENDENCIES

   You can use a few handy dependencies in your job:

   - dependencies.easyRequest : a wrapper on top of the &#x22;request&#x22; module
   - dependencies.request : the popular http request module itself
   - dependencies.logger : atlasboard logger interface

   Check them all out: https://bitbucket.org/atlassian/atlasboard/raw/master/lib/job-dependencies/?at=master

   */
</span>
  var logger = dependencies.logger;

  /*

   2. CONFIGURATION CHECK

   You probably want to check that the right configuration has been passed to the job.
   It is a good idea to cover this with unit tests as well (see test/&#x3c;%=name%&#x3e; file)

   Checking for the right configuration could be something like this:

   if (!config.myrequiredConfig) {
   return jobCallback(&#x27;missing configuration properties!&#x27;);
   }


   3. SENDING DATA BACK TO THE WIDGET

   You can send data back to the widget anytime (ex: if you are hooked into a real-time data stream and
   don&#x27;t want to depend on the jobCallback triggered by the scheduler to push data to widgets)

   jobWorker.pushUpdate({data: { title: config.widgetTitle, html: &#x27;loading...&#x27; }}); // on Atlasboard &#x3e; 1.0


   4. USE OF JOB_CALLBACK

   Using nodejs callback standard conventions, you should return an error or null (if success)
   as the first parameter, and the widget&#x27;s data as the second parameter.

   This is an example of how to make an HTTP call to google using the easyRequest dependency,
   and send the result to the registered widgets.
   Have a look at test/&#x3c;%=name%&#x3e; for an example of how to unit tests this easily by mocking easyRequest calls

   */

  dependencies.easyRequest.HTML(&#x27;http://google.com&#x27;, function (err, html) {
    // logger.trace(html);
    jobCallback(err, {title: config.widgetTitle, html: html});
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  packagesPath: [packagesNoSharedStateForJobs],
  configPath: configPath
};

jobs_manager.getJobs(options, function(err, job_workers){
  assert.ok(!err, err);
  assert.equal(job_workers.length, 2);
  job_workers[0].<span class="apidocCodeKeywordSpan">onRun</span>(null, null, function(err, data){
    assert.ok(!data);
    job_workers[1].onRun(null, null, function(err, data){
      assert.ok(!data);
      done();
    });
  });
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.event_queue" id="apidoc.module.atlasboard.event_queue">module atlasboard.event_queue</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.event_queue.event_queue" id="apidoc.element.atlasboard.event_queue.event_queue">
        function <span class="apidocSignatureSpan">atlasboard.</span>event_queue
        <span class="apidocSignatureSpan">(io)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventQueue(io) {
  this.io = io;
  this.latestEvents = {};
  var self = this;

  io.on(&#x22;connection&#x22;, function (socket) {
    socket.on(&#x22;resend&#x22;, function (data) {
      if (self.latestEvents[data]) {
        socket.emit(data, self.latestEvents[data]);
      }
    });

    // broadcast logs
    socket.on(&#x22;log&#x22;, function (data) {
      socket.broadcast.emit(&#x27;client&#x27;, data);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.event_queue.prototype" id="apidoc.module.atlasboard.event_queue.prototype">module atlasboard.event_queue.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.event_queue.prototype.send" id="apidoc.element.atlasboard.event_queue.prototype.send">
        function <span class="apidocSignatureSpan">atlasboard.event_queue.prototype.</span>send
        <span class="apidocSignatureSpan">(id, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (id, data) {
  this.latestEvents[id] = data;
  this.io.emit(id, data); // emit to widget
  this.io.emit(&#x27;client&#x27;, {widgetId: id, data: data}); // emit to logger
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// unique id for this widget in the wallboard
jobWorker.id = jobWorker.dashboard_name + &#x27;-&#x27; +
    (jobWorker.widget_item.r || jobWorker.widget_item.row) + &#x27;-&#x27; +
    (jobWorker.widget_item.c || jobWorker.widget_item.col);

jobWorker.pushUpdate = function (data) {
  eventQueue.<span class="apidocCodeKeywordSpan">send</span>(jobWorker.id, data);
};

// add security info
jobWorker.config.globalAuth = globalAuth;

if (jobWorker.widget_item.enabled !== false) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.helpers" id="apidoc.module.atlasboard.helpers">module atlasboard.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.helpers.areValidPathElements" id="apidoc.element.atlasboard.helpers.areValidPathElements">
        function <span class="apidocSignatureSpan">atlasboard.helpers.</span>areValidPathElements
        <span class="apidocSignatureSpan">(paths)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">areValidPathElements = function (paths) {

  function valid(path){
    if (!path) {
      return false;
    }

    var malicius = false;
    path = path.toString(); //in case it is another type, like number

    if ((path.indexOf(&#x22;/&#x22;) !== -1) || (path.indexOf(&#x22;\\&#x22;) !== -1)) {
      malicius = true;
    }

    if (path.indexOf(&#x22;..&#x22;) !== -1) {
      malicius = true;
    }

    if (path.indexOf(&#x27;\0&#x27;) !== -1) {
      malicius = true;
    }

    if (malicius){
      console.log(&#x22;Malicious path detected: %s&#x22;, path);
      return false;
    }
    else {
      return true;
    }
  }

  paths = Array.isArray(paths) ? paths : [paths];
  return paths.every(valid);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  assert.ok(!helpers.isPathContainedInRoot(&#x22;/test/wibble&#x22;, 333));
});

  });

  describe(&#x27;areValidPathElements&#x27;, function () {
it(&#x27;should sanitize string input&#x27;, function () {
  assert.ok(helpers.<span class="apidocCodeKeywordSpan">areValidPathElements</span>(&#x22;wibble&#x22;));
  assert.ok(!helpers.areValidPathElements(&#x22;../wibble&#x22;));
});

it(&#x27;should sanitize arrays of string input&#x27;, function () {
  assert.ok(helpers.areValidPathElements([&#x22;wibble&#x22;, &#x22;other valid&#x22;]));
  assert.ok(!helpers.areValidPathElements([&#x22;../wibble&#x22;, &#x22;valid&#x22;]));
  assert.ok(!helpers.areValidPathElements([&#x22;../wibble&#x22;, &#x22;../invalid&#x22;]));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.helpers.getJSONFromFile" id="apidoc.element.atlasboard.helpers.getJSONFromFile">
        function <span class="apidocSignatureSpan">atlasboard.helpers.</span>getJSONFromFile
        <span class="apidocSignatureSpan">(path, defaultValue, warnIfFileNotExists, warnIfFileIsInvalid)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getJSONFromFile = function (path, defaultValue, warnIfFileNotExists, warnIfFileIsInvalid){
  try {
    if (!fs.existsSync(path)){
      if (warnIfFileNotExists) {
        warnIfFileNotExists(path);
      }
      return defaultValue;
    }
    return JSON.parse(fs.readFileSync(path));
  }
  catch (e){
    if (warnIfFileIsInvalid) {
      warnIfFileIsInvalid(path, e);
    }
    return defaultValue;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

  });

  describe(&#x27;getJSONFromFile&#x27;, function () {
it(&#x27;should return default value if file not found&#x27;, function () {
  var defaultValue = {};
  assert.equal(defaultValue, helpers.<span class="apidocCodeKeywordSpan">getJSONFromFile</span>(FILE_NOT_EXIST_PATH, defaultValue
));
  assert.equal(helpers.getJSONFromFile(FILE_NOT_EXIST_PATH, &#x22;test&#x22;), &#x22;test&#x22;);
});

it(&#x27;should call callback if file not found&#x27;, function (done) {
  helpers.getJSONFromFile(FILE_NOT_EXIST_PATH, {}, function (path) {
    assert.equal(FILE_NOT_EXIST_PATH, path);
    done();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.helpers.getRndInt" id="apidoc.element.atlasboard.helpers.getRndInt">
        function <span class="apidocSignatureSpan">atlasboard.helpers.</span>getRndInt
        <span class="apidocSignatureSpan">(min, max)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getRndInt = function (min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.helpers.isPathContainedInRoot" id="apidoc.element.atlasboard.helpers.isPathContainedInRoot">
        function <span class="apidocSignatureSpan">atlasboard.helpers.</span>isPathContainedInRoot
        <span class="apidocSignatureSpan">(pathDir, root)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isPathContainedInRoot = function (pathDir, root){
  if (typeof root !== &#x27;string&#x27; || typeof pathDir !== &#x27;string&#x27;){
    return false;
  }

  if (pathDir[0] !== &#x22;/&#x22;) {
    pathDir = path.join(process.cwd(), pathDir);
  }
  return pathDir.indexOf(root) === 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  var INVALID_JSON_PATH = path.join(process.cwd(), &#x27;test&#x27;, &#x27;fixtures&#x27;, &#x27;helpers&#x27;, &#x27;invalid-json
.json&#x27;);
  var VALID_JSON_PATH = path.join(process.cwd(), &#x27;test&#x27;, &#x27;fixtures&#x27;, &#x27;helpers&#x27;, &#x27;valid-json.json
&#x27;);
  var FILE_NOT_EXIST_PATH = &#x27;DOES-NOT-EXISTS.json&#x27;;

  describe(&#x27;isPathContainedInRoot&#x27;, function () {
it(&#x27;should contain root&#x27;, function () {
  assert.ok(helpers.<span class="apidocCodeKeywordSpan">isPathContainedInRoot</span>(&#x22;/test/wibble&#x22;, &#x22;/test&#x22;));
  assert.ok(!helpers.isPathContainedInRoot(&#x22;/root/test/wibble&#x22;, &#x22;/test&#x22;));
});

it(&#x27;should accept relative paths to the process&#x27;, function () {
  assert.ok(helpers.isPathContainedInRoot(&#x22;wibble&#x22;, process.cwd()));
  assert.ok(!helpers.isPathContainedInRoot(&#x22;/wibble&#x22;, process.cwd()));
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.helpers.readJSONFile" id="apidoc.element.atlasboard.helpers.readJSONFile">
        function <span class="apidocSignatureSpan">atlasboard.helpers.</span>readJSONFile
        <span class="apidocSignatureSpan">(dashboardPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">readJSONFile = function (dashboardPath, cb) {
  fs.readFile(dashboardPath, function read(err, data){
    if (err) { return cb (err); }
    try {
      cb(null, JSON.parse(data));
    } catch(e){
      cb(e);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  assert.equal(content.key1, &#x22;val1&#x22;);
});

  });

  describe(&#x27;readJSONFile&#x27;, function () {
it(&#x27;should parse handle non existent paths&#x27;, function (done) {
  helpers.<span class="apidocCodeKeywordSpan">readJSONFile</span>(FILE_NOT_EXIST_PATH, function (err) {
    assert.equal(err.code, &#x22;ENOENT&#x22;);
    done();
  });
});

it(&#x27;should handle invalid JSON&#x27;, function (done) {
  helpers.readJSONFile(INVALID_JSON_PATH, function (err) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.hipchat" id="apidoc.module.atlasboard.hipchat">module atlasboard.hipchat</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.hipchat.create" id="apidoc.element.atlasboard.hipchat.create">
        function <span class="apidocSignatureSpan">atlasboard.hipchat.</span>create
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (options) {
  var request = options.request || require (&#x27;request&#x27;);

  if (!options.api_key){
    throw &#x27;api_key required&#x27;;
  }

  var errors = {
    400: &#x27;Bad request. Please check your data&#x27;,
    401: &#x27;Unauthorized: API KEY not valid&#x27;,
    403: &#x27;You have exceeded the rate limit&#x27;,
    404: &#x27;Not found&#x27;,
    406: &#x27;You requested an invalid content type&#x27;,
    500: &#x27;Server Error&#x27;,
    503: &#x27;The method you requested is currently unavailable (due to maintenance or high load&#x27;
  };

  var onResponseBuilder = function (callback) {
    return function (err, response, body) {
      if (callback) {
        var errMsg = null;
        if (err || !response || response.statusCode != 200) {
          errMsg = err;
          if (response &#x26;&#x26; errors[response.statusCode]) {
            errMsg += &#x27; &#x27; + errors[response.statusCode] + &#x27;; &#x27; + body;
          }
        }
        callback(errMsg, response ? response.statusCode : null, body);
      }
    };
  };

  return {
<span class="apidocCodeCommentSpan">    /**
     * Push message to HipChat server
     * @param roomId id of the room (number)
     * @param from sender name
     * @param message body of the message
     * @param notify should trigger a room notification? values: 1,0
     * @param callback a callback to be executed when complete
     */
</span>    &#x27;message&#x27; : function (roomId, from, message, notify, callback){
      var url = API_URL + &#x27;v1/rooms/message?format=json&#x26;auth_token=&#x27; + options.api_key;

      var data = {
        &#x27;room_id&#x27; : roomId,
        &#x27;from&#x27; : from,
        &#x27;message&#x27; : message,
        &#x27;notify&#x27; : notify
      };

      request.post({
          url: url,
          headers:{&#x27;content-type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;},
          body: qstring.stringify(data)
        }, onResponseBuilder(callback));
    },
    /**
     * Get a room info from hipchat
     * @param roomId id of the room (number)
     * @param callback a callback to be executed when complete
     */
    &#x27;roomInfo&#x27; : function (roomId, callback){
      var url = API_URL + &#x27;v2/room/&#x27; + roomId + &#x27;?format=json&#x26;auth_token=&#x27; + options.api_key;
      request.get({url: url, json:true}, onResponseBuilder(callback));
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

describe(&#x27;Hipchat&#x27;, function(){

  describe(&#x27;auth&#x27;, function(){

it (&#x27;should throw error if no token provided&#x27;, function (done){
  assert.throws(function(){
    var hipchat = require (&#x27;../lib/hipchat&#x27;).<span class="apidocCodeKeywordSpan">create</span>(options);
  });
  done();
});

it (&#x27;should not throw error if token provided&#x27;, function (done){
  options.api_key = &#x27;bP9qjpnsfVPLadW2gKR3vF4t62LI4z3Dfkc0e7LmNCebxBUjKH&#x27;; //this is an example. not a valid key
  var hipchat = require (&#x27;../lib/hipchat&#x27;).create(options);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.item_manager" id="apidoc.module.atlasboard.item_manager">module atlasboard.item_manager</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.item_manager.get" id="apidoc.element.atlasboard.item_manager.get">
        function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>get
        <span class="apidocSignatureSpan">(packagesPath, itemType, extension, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (packagesPath, itemType, extension, callback) {
  this.getByPackage(packagesPath, itemType, extension, function (err, results) {
    if (err) {
      return callback(err);
    }
    var items = [];
    results.forEach(function (package) {
      items = items.concat(package.items);
    });
    callback(null, items);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

module.exports = {

onInit: function (config, dependencies) {
  dependencies.logger.info(&#x27;adding routes...&#x27;);
  dependencies.app.route(&#x22;/jobs/mycustomroute&#x22;)
      .<span class="apidocCodeKeywordSpan">get</span>(function (req, res) {
        res.end(&#x27;So something useful here&#x27;);
      });

},

onRun: function (config, dependencies, jobCallback) {
  // code to be executed every interval
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.item_manager.getByPackage" id="apidoc.element.atlasboard.item_manager.getByPackage">
        function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>getByPackage
        <span class="apidocSignatureSpan">(packagesPath, itemType, extension, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getByPackage = function (packagesPath, itemType, extension, callback) {

  if (!Array.isArray(packagesPath)) {
    packagesPath = [packagesPath];
  }

  function readItemsFromPackageDir(dir, cb) {
    var package = {dir: dir};

    var itemDir = path.join(dir, itemType);
    if (!fs.existsSync(itemDir)) {
      package.items = [];
      return cb(null, package);
    }

    // this functions parses:
    // - packages/default/&#x3c;itemType&#x3e;/*
    // - packages/otherpackages/&#x3c;itemType&#x3e;/*
    // for dashboards, or:
    // - packages/default/&#x3c;itemType&#x3e;/*/*.js
    // - packages/otherpackages/&#x3c;itemType&#x3e;/*/*.js
    // for jobs and widgets
    fs.readdir(itemDir, function (err, items) {
      if (err) {
        return cb(err);
      }

      var selectedItems = [];
      items.forEach(function (item_name) {
        var item = path.join(itemDir, item_name);
        var stat = fs.statSync(item);
        if (stat.isDirectory()) {
          // /job/job1/job1.js
          item = path.join(item, item_name + extension);
        }

        if (path.extname(item) === extension) {
          if (fs.existsSync(item)) {
            selectedItems.push(item);
          }
        }
      });

      if (filters[itemType]) { // change to use custom filters for itemType
        selectedItems = selectedItems.filter(filters[itemType]);
      }

      package.items = selectedItems;
      return cb(null, package);
    });
  }


  // this function read all the packages from the provided directory packagesPath:
  // - packages/default/*
  // - packages/otherpackages/*
  // and calls readItemsFromPackageDir for every one of them

  function fillPackages(packagesPath, cb) {
    fs.readdir(packagesPath, function (err, allPackagesDir) {
      if (err) {
        return cb(err);
      }

      // convert to absolute path
      allPackagesDir = allPackagesDir.map(function (partialDir) {
        return path.join(packagesPath, partialDir);
      });

      // get only valid directories
      allPackagesDir = allPackagesDir.filter(function (dir) {
        return fs.statSync(dir).isDirectory();
      });

      // read items from every package and flatten results
      async.map(allPackagesDir, readItemsFromPackageDir, function (err, results) {
        if (err) {
          return cb(err);
        }
        cb(null, _.flatten(results));
      });
    });
  }

  // process all package paths
  async.map(packagesPath.filter(fs.existsSync), fillPackages, function (err, results) {
    if (err) {
      return callback(err);
    }
    callback(null, _.flatten(results));
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * @param {[string]} packagesPath : list of directories to find packages in.
 * @param {string} itemType item type in plural. (&#x27;dashboards&#x27;, &#x27;jobs&#x27;, &#x27;widgets&#x27;)
 * @param {string} extension : filter result by extension
 */

get: function (packagesPath, itemType, extension, callback) {
  this.<span class="apidocCodeKeywordSpan">getByPackage</span>(packagesPath, itemType, extension, function (err, results) {
    if (err) {
      return callback(err);
    }
    var items = [];
    results.forEach(function (package) {
      items = items.concat(package.items);
    });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.item_manager.getFirst" id="apidoc.element.atlasboard.item_manager.getFirst">
        function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>getFirst
        <span class="apidocSignatureSpan">(packagesPath, itemName, itemType, extension, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFirst = function (packagesPath, itemName, itemType, extension, callback) {
  var thiz = this;
  this.get(packagesPath, itemType, extension, function (err, items) {
    if (err) {
      return callback(err);
    }

    var candidates = thiz.resolveCandidates(items, itemName, itemType, extension);
    callback(null, candidates.length ? candidates[0] : null);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    assert.equal(packages.length, 2);
    done();
  });
});

it(&#x27;should be able to pick up the right job with namespacing (1)&#x27;, function (done) {
  itemManager.<span class="apidocCodeKeywordSpan">getFirst</span>([packagesLocalFolder], &#x22;otherpackage1#job1&#x22;, &#x22;jobs
&#x22;, &#x22;.js&#x22;, function (err, job_path) {
    assert.ok(!err, err);
    assert.ok(job_path);
    var job = require(job_path);
    var result = job();
    assert.equal(&#x22;otherpackage1#job1&#x22;, result);
    done();
  });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.item_manager.resolveCandidates" id="apidoc.element.atlasboard.item_manager.resolveCandidates">
        function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>resolveCandidates
        <span class="apidocSignatureSpan">(items, name, itemType, extension)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">resolveCandidates = function (items, name, itemType, extension) {
  var searchCriteria = &#x22;&#x22;;
  if (name.indexOf(&#x22;#&#x22;) &#x3e; -1) {
    var packageName = name.split(&#x22;#&#x22;)[0];
    var itemParsedName = name.split(&#x22;#&#x22;)[1];
    // package/jobs/job1/job1.js
    searchCriteria = path.join(packageName, this.resolveLocation(itemParsedName, itemType, extension));
  }
  else {
    // jobs/job1/job1.js
    searchCriteria = this.resolveLocation(name, itemType, extension);
  }

  searchCriteria = path.sep + searchCriteria;

  return items.filter(function (item) {
    return item.indexOf(searchCriteria) &#x3e; -1;
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getFirst: function (packagesPath, itemName, itemType, extension, callback) {
  var thiz = this;
  this.get(packagesPath, itemType, extension, function (err, items) {
    if (err) {
      return callback(err);
    }

    var candidates = thiz.<span class="apidocCodeKeywordSpan">resolveCandidates</span>(items, itemName, itemType, extension);
    callback(null, candidates.length ? candidates[0] : null);
  });
},


/**
 * Return list of items found in any package within packagesPath
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.item_manager.resolveLocation" id="apidoc.element.atlasboard.item_manager.resolveLocation">
        function <span class="apidocSignatureSpan">atlasboard.item_manager.</span>resolveLocation
        <span class="apidocSignatureSpan">(name, itemType, extension)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">resolveLocation = function (name, itemType, extension) {
  var useDirectoryLevel = ((itemType === &#x22;widgets&#x22;) || (itemType === &#x22;jobs&#x22;));
  if (useDirectoryLevel) {
    // jobs/job1/job1.js
    return path.join(itemType, name, name + extension);
  }
  else {
    // dashboards/dashboard.json
    return path.join(itemType, name + extension);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  resolveCandidates: function (items, name, itemType, extension) {
var searchCriteria = &#x22;&#x22;;
if (name.indexOf(&#x22;#&#x22;) &#x3e; -1) {
  var packageName = name.split(&#x22;#&#x22;)[0];
  var itemParsedName = name.split(&#x22;#&#x22;)[1];
  // package/jobs/job1/job1.js
  searchCriteria = path.join(packageName, this.<span class="apidocCodeKeywordSpan">resolveLocation</span>(itemParsedName, itemType
, extension));
}
else {
  // jobs/job1/job1.js
  searchCriteria = this.resolveLocation(name, itemType, extension);
}

searchCriteria = path.sep + searchCriteria;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.job_initialiser" id="apidoc.module.atlasboard.job_initialiser">module atlasboard.job_initialiser</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.job_initialiser.init" id="apidoc.element.atlasboard.job_initialiser.init">
        function <span class="apidocSignatureSpan">atlasboard.job_initialiser.</span>init
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(options, cb) {

  jobsManager.getJobs(options, function (err, jobWorkers) {
    if (err) {
      return cb(err);
    }

    var globalAuth = loadGlobalAuth(configManager(&#x27;auth&#x27;).authenticationFilePath);

    if (!jobWorkers.length) {
      logger.warn(&#x22;No jobs found matching the current configuration and filters&#x22;);
    }
    else {
      var eventQueue = new EventQueue(options.deps.io);
      jobWorkers.forEach(function (jobWorker, index) {

        // unique id for this widget in the wallboard
        jobWorker.id = jobWorker.dashboard_name + &#x27;-&#x27; +
            (jobWorker.widget_item.r || jobWorker.widget_item.row) + &#x27;-&#x27; +
            (jobWorker.widget_item.c || jobWorker.widget_item.col);

        jobWorker.pushUpdate = function (data) {
          eventQueue.send(jobWorker.id, data);
        };

        // add security info
        jobWorker.config.globalAuth = globalAuth;

        if (jobWorker.widget_item.enabled !== false) {

          jobDependencyManager.fillDependencies(jobWorker, options.deps);

          if (jobWorker.onInit) {
            jobWorker.onInit.call(jobWorker, jobWorker.config, jobWorker.dependencies);
          }

          if (jobWorker.onRun) {
            setTimeout(function () {
              var scheduler = new Scheduler(jobWorker);
              scheduler.start();
            }, index * 1500); // avoid a concurrency peak on startup
          }
        }
        else { // job is disabled
          jobWorker.pushUpdate({error: &#x27;disabled&#x27;});
        }

      });
    }
    return cb();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var jobOptions = {
    packagesPath: [packagesLocalFolder, packagesAtlasboardFolder],
    configPath: configPath,
    filters: options.filters,
    deps: {io: io, app: app}
  };

  jobInitialiser.<span class="apidocCodeKeywordSpan">init</span>(jobOptions, cb);
};

if (options.install) {
  console.log(&#x27;Installing dependencies...&#x27;.gray);
  packageDependencyManager.installDependencies([packagesLocalFolder], function (err) {
    if (err) {
      return callback(err);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.job_manager" id="apidoc.module.atlasboard.job_manager">module atlasboard.job_manager</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.job_manager.getJobs" id="apidoc.element.atlasboard.job_manager.getJobs">
        function <span class="apidocSignatureSpan">atlasboard.job_manager.</span>getJobs
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getJobs = function (options, callback) {

  var packagesPath = options.packagesPath;
  var filters = options.filters || {};

  var configPath = path.join(options.configPath,&#x22;/dashboard_common.json&#x22;);
  var generalDashboardConfig = {};

  var jobs = [];

  // ----------------------------------------------
  // general config is optional, but if it exists it needs to be a valid file
  // ----------------------------------------------
  if (fs.existsSync(configPath)){
    try{
      generalDashboardConfig = JSON.parse(fs.readFileSync(configPath)).config;
      if (!generalDashboardConfig) {
        throw &#x27;invalid format. config property not found&#x27;;
      }
    }
    catch (e){
      return callback(&#x22;ERROR reading general config file...&#x22; + configPath);
    }
  }

  // ----------------------------------------------
  // get all dashboards from all packages folder
  // ----------------------------------------------
  itemManager.get(packagesPath, &#x22;dashboards&#x22;, &#x22;.json&#x22;, function(err, dashboardConfigFiles){
    if (err){ return callback(err); }

    // ----------------------------------------------
    // get all jobs from those packages
    // ----------------------------------------------
    itemManager.get(packagesPath, &#x22;jobs&#x22;, &#x22;.js&#x22;, function(err, allJobs){
      if (err){ return callback(err); }

      for (var d = 0, dl = dashboardConfigFiles.length; d &#x3c; dl ; d++) {
        var dashboardName = dashboardConfigFiles[d];

        if (filters.dashboardFilter){
          if (!matchDashboardFilter(dashboardName, filters.dashboardFilter)){
            continue;
          }
        }

        var dashboardConfig;
        var dashboardJobs;
        try {
          dashboardConfig = readDashboard(dashboardName);
          dashboardJobs = processDashboard(allJobs, dashboardName, dashboardConfig, filters);
        }
        catch (e){
          return callback (e);
        }

        // add config to job, extending for the same config key in general config, if any
        dashboardJobs = dashboardJobs.map(function(job){
          // Multiple configurations:
          //  local overrides global
          //  config n+1 overrides config n
          if (Array.isArray(job.configKey)) {
            var configs = job.configKey.map(function(key){
              return extend(generalDashboardConfig[key], dashboardConfig.config[key]);
            });
            job.config = extend.apply(null, configs);
          } else { // single configuration
            job.config = extend(generalDashboardConfig[job.configKey], dashboardConfig.config[job.configKey]);
          }

          return job;
        });

        jobs = jobs.concat(dashboardJobs);
      }

      callback(null, jobs);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var jobDependencyManager = require(&#x27;./job-dependencies/loader.js&#x27;);
var logger = require(&#x27;./logger&#x27;)();

exports = module.exports = (function () {

  function init(options, cb) {

    jobsManager.<span class="apidocCodeKeywordSpan">getJobs</span>(options, function (err, jobWorkers) {
if (err) {
  return cb(err);
}

var globalAuth = loadGlobalAuth(configManager(&#x27;auth&#x27;).authenticationFilePath);

if (!jobWorkers.length) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.loader" id="apidoc.module.atlasboard.loader">module atlasboard.loader</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.loader.fillDependencies" id="apidoc.element.atlasboard.loader.fillDependencies">
        function <span class="apidocSignatureSpan">atlasboard.loader.</span>fillDependencies
        <span class="apidocSignatureSpan">(jobWorker, deps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fillDependencies = function (jobWorker, deps) {

  jobWorker.dependencies = {};

  var dependencyFolders = fs.readdirSync(__dirname);
  for (var i = dependencyFolders.length - 1; i &#x3e;= 0; i--) {
    var folderPath = path.join(__dirname, dependencyFolders[i]);
    var stat = fs.statSync(folderPath);
    if (stat.isDirectory()) {
      try {
        var depPath = path.join(folderPath, &#x27;dependency.js&#x27;);
        jobWorker.dependencies[dependencyFolders[i]] = require(depPath)(jobWorker, deps);
      }
      catch (e) {
        throw &#x27;error resolving dependency &#x27; + dependencyFolders[i] + &#x27;. ERROR:&#x27; + e;
      }
    }
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
          };

          // add security info
          jobWorker.config.globalAuth = globalAuth;

          if (jobWorker.widget_item.enabled !== false) {

jobDependencyManager.<span class="apidocCodeKeywordSpan">fillDependencies</span>(jobWorker, options.deps);

if (jobWorker.onInit) {
  jobWorker.onInit.call(jobWorker, jobWorker.config, jobWorker.dependencies);
}

if (jobWorker.onRun) {
  setTimeout(function () {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.logic" id="apidoc.module.atlasboard.logic">module atlasboard.logic</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.logic.log" id="apidoc.element.atlasboard.logic.log">
        function <span class="apidocSignatureSpan">atlasboard.logic.</span>log
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (req, res){
  res.render(path.join(__dirname, &#x22;../..&#x22;, &#x22;templates&#x22;, &#x22;dashboard-log.ejs&#x22;));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### Logging from your job:

```
module.exports = function(config, dependencies, job_callback) {
var text = &#x22;Hello World!&#x22;;

var logger = dependencies.logger;
logger.<span class="apidocCodeKeywordSpan">log</span>(&#x27;I am a log message&#x27;);
logger.trace(&#x27;text is &#x27; + text);
logger.debug(&#x27;text is &#x27; + text);
logger.info(&#x27;I am an info message&#x27;);
logger.warn(&#x27;I am a warning message&#x27;);
logger.error(&#x27;this is an error!&#x27;)

job_callback(null, {title: config.widgetTitle, text: text});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.logic.renderJsDashboard" id="apidoc.element.atlasboard.logic.renderJsDashboard">
        function <span class="apidocSignatureSpan">atlasboard.logic.</span>renderJsDashboard
        <span class="apidocSignatureSpan">(packagesPath, wallboardAssetsFolder, dashboardName, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderJsDashboard = function (packagesPath, wallboardAssetsFolder, dashboardName, req, res){

  function pipeCustomJSFileNameToResponse (fileName, cb){
    var assetFullPath = path.join(wallboardAssetsFolder, &#x27;/javascripts/&#x27;, fileName);
    fs.readFile(assetFullPath, function(err, fileContent) {
      if (err) {
        logger.error(assetFullPath + &#x22; not found&#x22;);
      }
      else {
        res.write(fileContent + &#x22;\n\n&#x22;);
      }
      cb(null);
    });
  }

  dashboardName = getSafeItemName(dashboardName);
  itemManager.getFirst(packagesPath, dashboardName, &#x22;dashboards&#x22;, &#x22;.json&#x22;, function(err, dashboardPath){
    if (err || !dashboardPath){
      return res.status(err ? 400 : 404).send(err ? err : &#x22;Trying to render dashboard &#x22; +
          dashboardName + &#x22;, but couldn&#x27;t find any dashboard in the packages folder&#x22;);
    }
    helpers.readJSONFile(dashboardPath, function(err, dashboardJSON){
      if (err){
        return res.status(400).send(&#x22;Error reading dashboard&#x22;);
      } else{
        res.type(&#x22;application/javascript&#x22;);
        async.eachSeries((dashboardJSON.layout.customJS || []), pipeCustomJSFileNameToResponse, function(){
          res.end();
        });
      }
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var packagesWithInvalidDashboardFile = path.join(process.cwd(), &#x22;/test/fixtures/package_invalid_format&#x22;);

  describe(&#x27;javascript assets&#x27;, function () {

    describe(&#x27;for dashboard&#x27;, function () {

it(&#x27;return javascript assets for a certain dashboard&#x27;, function (done) {
  webLogic.<span class="apidocCodeKeywordSpan">renderJsDashboard</span>([packagesLocalFolder, packagesAtlasboardFolder], wallboard_assets_folder
,
      &#x22;test_dashboard1&#x22;, {}, responseHelpers.getResponseWriteEnd(&#x22;Peity&#x22;, &#x22;application/javascript&#x22;,
done));
});

it(&#x27;returns error when requesting javascript assets for a dashboard that doesn\&#x27;t exist&#x27;, function (done) {
  webLogic.renderJsDashboard([packagesLocalFolder, packagesAtlasboardFolder], wallboard_assets_folder,
      &#x22;tttttest_dashboard1&#x22;, {}, responseHelpers.getResponseForSendStatusCode(404, done));
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.package_dependency_manager" id="apidoc.module.atlasboard.package_dependency_manager">module atlasboard.package_dependency_manager</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.package_dependency_manager.installDependencies" id="apidoc.element.atlasboard.package_dependency_manager.installDependencies">
        function <span class="apidocSignatureSpan">atlasboard.package_dependency_manager.</span>installDependencies
        <span class="apidocSignatureSpan">(packagesPath, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">installDependencies = function (packagesPath, callback){

  // Process all available package containers
  async.map (packagesPath.filter(fs.existsSync), checkPackagesFolder, function(err, results){
    if (err){ return callback(err); }
    var paths = _.flatten(results);

    async.eachSeries(paths, checkValidIfAtlasboardVersionForPackage, function (err){
      if (err){
        return callback(err);
      }

      async.eachSeries(paths, install, function (err){
        callback(err);
      });
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  };

  jobInitialiser.init(jobOptions, cb);
};

if (options.install) {
  console.log(&#x27;Installing dependencies...&#x27;.gray);
  packageDependencyManager.<span class="apidocCodeKeywordSpan">installDependencies</span>([packagesLocalFolder], function (err) {
    if (err) {
      return callback(err);
    }
    console.log(&#x27;done!&#x27;.green);
    runner(callback);
  });
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.path_resolver" id="apidoc.module.atlasboard.path_resolver">module atlasboard.path_resolver</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.path_resolver.fromAtlasboard" id="apidoc.element.atlasboard.path_resolver.fromAtlasboard">
        function <span class="apidocSignatureSpan">atlasboard.path_resolver.</span>fromAtlasboard
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fromAtlasboard = function () {
  return getFromRootPath(__dirname, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var debug = require(&#x27;debug&#x27;)(&#x27;theming&#x27;);

exports = module.exports = (function () {

var themingConfig = configManager(&#x27;theming&#x27;);

var localTheme = pathResolver.fromLocalWallboard(&#x27;themes&#x27;, themingConfig.theme, &#x27;variables.styl&#x27;);
var atlasboardTheme = pathResolver.<span class="apidocCodeKeywordSpan">fromAtlasboard</span>(&#x27;../themes&#x27;, themingConfig
.theme, &#x27;variables.styl&#x27;);

var defaultTheme = pathResolver.fromAtlasboard(&#x27;../assets&#x27;, &#x27;stylesheets&#x27;, &#x27;variables.styl&#x27;);

function getStylusObject(str) {
  var stylObj = stylus(str);
  stylObj.import(defaultTheme); // import default core stylus variables
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.path_resolver.fromLocalWallboard" id="apidoc.element.atlasboard.path_resolver.fromLocalWallboard">
        function <span class="apidocSignatureSpan">atlasboard.path_resolver.</span>fromLocalWallboard
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fromLocalWallboard = function () {
  return getFromRootPath(process.cwd(), arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var pathResolver = require(&#x27;./path-resolver&#x27;);
var debug = require(&#x27;debug&#x27;)(&#x27;theming&#x27;);

exports = module.exports = (function () {

var themingConfig = configManager(&#x27;theming&#x27;);

var localTheme = pathResolver.<span class="apidocCodeKeywordSpan">fromLocalWallboard</span>(&#x27;themes&#x27;, themingConfig.theme
, &#x27;variables.styl&#x27;);
var atlasboardTheme = pathResolver.fromAtlasboard(&#x27;../themes&#x27;, themingConfig.theme, &#x27;variables.styl&#x27;);

var defaultTheme = pathResolver.fromAtlasboard(&#x27;../assets&#x27;, &#x27;stylesheets&#x27;, &#x27;variables.styl&#x27;);

function getStylusObject(str) {
  var stylObj = stylus(str);
  stylObj.import(defaultTheme); // import default core stylus variables
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.scaffolding" id="apidoc.module.atlasboard.scaffolding">module atlasboard.scaffolding</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.scaffolding.scaffold" id="apidoc.element.atlasboard.scaffolding.scaffold">
        function <span class="apidocSignatureSpan">atlasboard.scaffolding.</span>scaffold
        <span class="apidocSignatureSpan">(templateSourceFolder, destinationFolder, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">scaffold = function (templateSourceFolder, destinationFolder, options, cb){

  if (!cb) { // options parameter is optional
    cb = options;
    options = {};
  }

  function applyReplacements(fileName, replacements){
    for (var item in replacements) {
      var replace = replacements[item];
      if (fileName.indexOf(item) &#x3e; -1) {
        fileName = fileName.replace(item, replace);
        break;
      }
    }
    return fileName;
  }

  // based on http://stackoverflow.com/questions/13786160/copy-folder-recursively-in-node-js
  var copyRecursiveSync = function(src, dest) {
    var exists = fs.existsSync(src);
    var stats = exists &#x26;&#x26; fs.statSync(src);
    var isDirectory = exists &#x26;&#x26; stats.isDirectory();
    if (exists &#x26;&#x26; isDirectory) {
      debug(&#x27;creating directory&#x27;, dest);
      fs.mkdirSync(dest);
      fs.readdirSync(src).forEach(function(childItemName) {
        debug(&#x27;copying from&#x27;, src, &#x27;into&#x27;, dest, &#x27;File:&#x27;, childItemName);
        copyRecursiveSync(path.join(src, childItemName),
                          path.join(dest, childItemName));
      });
    } else {
      var destinationFile =  applyReplacements(dest, options.replace || {});
      var output = fs.readFileSync(src).toString();
      if (options.engine === &#x27;ejs&#x27;) {
        output = ejs.render(output, options.data);
      }
      fs.writeFileSync(destinationFile, output);
    }
  };

  mkdirp(path.dirname(destinationFolder), function(err){
    if (err) {
      return cb(err);
    }

    copyRecursiveSync(templateSourceFolder, destinationFolder);
    cb();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
cleanup(done);
  });

  describe (&#x27;scaffolding folder&#x27;, function(){

it(&#x27;copy all items within the template folder to the destination folder&#x27;, function(done){
  var destinationFolder = path.join(temp_folder,&#x27;simplefolder&#x27;);
  scaffolding.<span class="apidocCodeKeywordSpan">scaffold</span>(simpleFolder, destinationFolder, function(err){
    assert.ok(!err, err);
    fs.readdir(destinationFolder, function(err, files) {
      assert.equal(files.length, 2, &#x27;all files were copied&#x27;);
      done();
    });
  });
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.scheduler" id="apidoc.module.atlasboard.scheduler">module atlasboard.scheduler</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.scheduler.scheduler" id="apidoc.element.atlasboard.scheduler.scheduler">
        function <span class="apidocSignatureSpan">atlasboard.</span>scheduler
        <span class="apidocSignatureSpan">(jobWorker)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Scheduler(jobWorker) {
  this.jobWorker = ensureSafeJobWorkerConfiguration(jobWorker);
  this.originalInterval = jobWorker.config.interval;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.scheduler.prototype" id="apidoc.module.atlasboard.scheduler.prototype">module atlasboard.scheduler.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.scheduler.prototype.scheduleNext" id="apidoc.element.atlasboard.scheduler.prototype.scheduleNext">
        function <span class="apidocSignatureSpan">atlasboard.scheduler.prototype.</span>scheduleNext
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">scheduleNext = function (){
  var self = this;
  setTimeout(function(){
    self.start();
  }, this.jobWorker.config.interval);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if (err) {
      handleError(err);
    }
    else {
      handleSuccess(data);
    }
    self.<span class="apidocCodeKeywordSpan">scheduleNext</span>();
  }

  job.onRun.call(job, job.config, job.dependencies, jobCallback);

}
catch (e) {
  job.dependencies.logger.error(&#x27;Uncaught exception executing job: &#x27; + e);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.scheduler.prototype.start" id="apidoc.element.atlasboard.scheduler.prototype.start">
        function <span class="apidocSignatureSpan">atlasboard.scheduler.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {

  var self = this;
  var job = self.jobWorker;

  function handleError(err) {

    job.dependencies.logger.error(&#x27;executed with errors: &#x27; + err);

    // in case of error retry in one third of the original interval or 1 min, whatever is lower
    job.config.interval = Math.min(self.originalInterval / 3, 60000);

    // -------------------------------------------------------------
    // Decide if we hold error notification according to widget config.
    // if the retryOnErrorTimes property found in config, the error notification
    // wont be sent until we reach that number of consecutive errrors.
    // This will prevent showing too many error when connection to flaky, unreliable
    // servers.
    // -------------------------------------------------------------
    var sendError = true;
    if (job.firstRun === false) {
      if (job.config.retryOnErrorTimes) {
        job.retryOnErrorCounter = job.retryOnErrorCounter || 0;
        if (job.retryOnErrorCounter &#x3c;= job.config.retryOnErrorTimes) {
          job.dependencies.logger.warn(&#x27;widget with retryOnErrorTimes. attempts: &#x27; +
              job.retryOnErrorCounter);
          sendError = false;
          job.retryOnErrorCounter++;
        }
      }
    }
    else {
      // this is the first run for this job so if it fails, we want to inform immediately
      // since it may be a configuration or dev related problem.
      job.firstRun = false;
    }

    if (sendError) {
      job.pushUpdate({error: err, config: {interval: job.config.interval}});
    }
  }

  function handleSuccess(data) {
    job.retryOnErrorCounter = 0; //reset error counter on success
    job.dependencies.logger.log(&#x27;executed OK&#x27;);
    job.config.interval = self.originalInterval;
    if (!data) {
      data = {};
    }
    data.config = {interval: job.config.interval}; // give access to interval to client
    job.pushUpdate(data);
  }

  try {

    var cbCalled = false; // job_callback is meant to be executed only once per job run

    function jobCallback (err, data){
      if (cbCalled) {
        job.dependencies.logger.warn(&#x27;WARNING!!!!: job_callback executed more than once for job &#x27; +
        job.widget_item.job + &#x27; in dashboard &#x27; + job.dashboard_name);
      }
      cbCalled = true;

      if (err) {
        handleError(err);
      }
      else {
        handleSuccess(data);
      }
      self.scheduleNext();
    }

    job.onRun.call(job, job.config, job.dependencies, jobCallback);

  }
  catch (e) {
    job.dependencies.logger.error(&#x27;Uncaught exception executing job: &#x27; + e);
    handleError(e);
    self.scheduleNext();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if (jobWorker.onInit) {
    jobWorker.onInit.call(jobWorker, jobWorker.config, jobWorker.dependencies);
  }

  if (jobWorker.onRun) {
    setTimeout(function () {
      var scheduler = new Scheduler(jobWorker);
      scheduler.<span class="apidocCodeKeywordSpan">start</span>();
    }, index * 1500); // avoid a concurrency peak on startup
  }
}
else { // job is disabled
  jobWorker.pushUpdate({error: &#x27;disabled&#x27;});
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.storage_base" id="apidoc.module.atlasboard.storage_base">module atlasboard.storage_base</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.storage_base.storage_base" id="apidoc.element.atlasboard.storage_base.storage_base">
        function <span class="apidocSignatureSpan">atlasboard.</span>storage_base
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StorageBase(){ }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.storage_base.prototype" id="apidoc.module.atlasboard.storage_base.prototype">module atlasboard.storage_base.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.storage_base.prototype.get" id="apidoc.element.atlasboard.storage_base.prototype.get">
        function <span class="apidocSignatureSpan">atlasboard.storage_base.prototype.</span>get
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key, callback){}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

module.exports = {

onInit: function (config, dependencies) {
  dependencies.logger.info(&#x27;adding routes...&#x27;);
  dependencies.app.route(&#x22;/jobs/mycustomroute&#x22;)
      .<span class="apidocCodeKeywordSpan">get</span>(function (req, res) {
        res.end(&#x27;So something useful here&#x27;);
      });

},

onRun: function (config, dependencies, jobCallback) {
  // code to be executed every interval
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.storage_base.prototype.set" id="apidoc.element.atlasboard.storage_base.prototype.set">
        function <span class="apidocSignatureSpan">atlasboard.storage_base.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value, callback){}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    getMiddleware: function (options) {
return stylus.middleware({
  src: options.src,
  dest: options.dest,

  compile: function (str, filePath) {
    var stylObj = getStylusObject(str);
    stylObj.<span class="apidocCodeKeywordSpan">set</span>(&#x27;filename&#x27;, filePath)
        .set(&#x27;warn&#x27;, false)
        .set(&#x27;compress&#x27;, true)
        .use(nib());

    return stylObj;
  }
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.stylus" id="apidoc.module.atlasboard.stylus">module atlasboard.stylus</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.stylus.getMiddleware" id="apidoc.element.atlasboard.stylus.getMiddleware">
        function <span class="apidocSignatureSpan">atlasboard.stylus.</span>getMiddleware
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getMiddleware = function (options) {
  return stylus.middleware({
    src: options.src,
    dest: options.dest,

    compile: function (str, filePath) {
      var stylObj = getStylusObject(str);
      stylObj.set(&#x27;filename&#x27;, filePath)
          .set(&#x27;warn&#x27;, false)
          .set(&#x27;compress&#x27;, true)
          .use(nib());

      return stylObj;
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
app.use(morgan(configManager(&#x27;logging&#x27;).morgan));
app.use(compression());
app.use(bodyParser.urlencoded({extended: false}));
app.use(bodyParser.json());
app.use(methodOverride());
app.use(errorhandler());

app.use(stylus.<span class="apidocCodeKeywordSpan">getMiddleware</span>({
  src: atlasboardAssetsFolder,
  dest: compiledAssetsFolder
}));

// -----------------------------------------
//  Expose both wallboard and Atlasboard assets.
//  Local wallboard assets take precedence
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.stylus.getWidgetCSS" id="apidoc.element.atlasboard.stylus.getWidgetCSS">
        function <span class="apidocSignatureSpan">atlasboard.stylus.</span>getWidgetCSS
        <span class="apidocSignatureSpan">(str, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getWidgetCSS = function (str, cb) {
  getStylusObject(str).render(cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    cb(err);
  });
}

function loadStylusIfPresent(res, cb) {
  getFileContents(&#x22;.styl&#x22;, function(err, stylusContent){
    if (!err &#x26;&#x26; stylusContent) {
      stylus.<span class="apidocCodeKeywordSpan">getWidgetCSS</span>(stylusContent, function(err, css){
        if (!err) {
          addNamespacesCSSToResponse(css, widgetName, res);
        } else {
          logger.error(err);
        }
        cb(err);
      });
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.template_manager" id="apidoc.module.atlasboard.template_manager">module atlasboard.template_manager</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.template_manager.resolveTemplateLocation" id="apidoc.element.atlasboard.template_manager.resolveTemplateLocation">
        function <span class="apidocSignatureSpan">atlasboard.template_manager.</span>resolveTemplateLocation
        <span class="apidocSignatureSpan">(fileName, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">resolveTemplateLocation = function (fileName, cb) {
  var localWallboardLocation = path.join(process.cwd(), &#x22;templates&#x22;, fileName);
  var defaultAtlasboardLocation = path.join(__dirname, &#x22;../templates&#x22;, fileName);
  fs.exists(localWallboardLocation, function(exists){
    if (exists) {
      cb(null, localWallboardLocation);
    }
    else {
      cb(null, defaultAtlasboardLocation);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var assert = require (&#x27;assert&#x27;);
var path = require (&#x27;path&#x27;);
var templateManager = require(&#x27;../lib/template-manager&#x27;);

describe(&#x27;template manager&#x27;, function(){

  it(&#x27;should resolve global location of template&#x27;, function(done) {
    templateManager.<span class="apidocCodeKeywordSpan">resolveTemplateLocation</span>(&#x22;dashboard.ejs&#x22;, function(err,
location){
      assert.equal(location, path.join(__dirname, &#x22;../templates&#x22;, &#x22;dashboard.ejs&#x22;));
      done();
    });
  });

});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.atlasboard.widget" id="apidoc.module.atlasboard.widget">module atlasboard.widget</a></h1>


    <h2>
        <a href="#apidoc.element.atlasboard.widget._addNamespace" id="apidoc.element.atlasboard.widget._addNamespace">
        function <span class="apidocSignatureSpan">atlasboard.widget.</span>_addNamespace
        <span class="apidocSignatureSpan">(css, res, widgetNamespace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addNamespace(css, res, widgetNamespace){
  function namespaceRulesAST (rules) {
    rules.forEach(function (rule) {
      if (rule.selectors) {
        rule.selectors = rule.selectors.map(function (selector) {
          if (selector === &#x27;@font-face&#x27;) {
            return selector;
          }
          // it is important to set the right specificity to widget rules can precede the default ones
          return &#x27;#widgets-container &#x3e; ul &#x3e; li[data-widget-id=&#x22;&#x27; + widgetNamespace + &#x27;&#x22;] &#x27; + selector;
        });
      }
      // Handle rules within media queries
      if (rule.rules) {
        namespaceRulesAST(rule.rules);
      }
    });
  }

  if (css) {
    try {
      var cssAST = cssModule.parse(css.toString());
      namespaceRulesAST(cssAST.stylesheet.rules);
      res.write(cssModule.stringify(cssAST));
    } catch (e) {
      logger.error(e);
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function assertNotContains(source, match, msg) {
  return assert.ok(source.indexOf(match) === -1, msg);
}

it(&#x27;should namespace CSS selectors&#x27;, function () {
  var res = responseHelpers.getResponseWriteBasic();
  var css = getCss(&#x27;basic.css&#x27;);
  widgetRouteLogic.<span class="apidocCodeKeywordSpan">_addNamespace</span>(css, res, &#x27;test-namespace&#x27;);
  assertContains(res.written, &#x27;li[data-widget-id=&#x22;test-namespace&#x22;] #id {&#x27;, &#x27;#id&#x27;);
  assertContains(res.written, &#x27;li[data-widget-id=&#x22;test-namespace&#x22;] tag {&#x27;, &#x27;tag&#x27;);
  assertContains(res.written, &#x27;li[data-widget-id=&#x22;test-namespace&#x22;] #multiple .things {&#x27;, &#x27;multiple identifiers
&#x27;);
  assertContains(res.written, &#x27;li[data-widget-id=&#x22;test-namespace&#x22;] .comma,&#x27;, &#x27;comma-separated rules (1)&#
x27;);
  assertContains(res.written, &#x27;li[data-widget-id=&#x22;test-namespace&#x22;] .separated {&#x27;, &#x27;comma-separated rules
 (2)&#x27;);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.widget.log" id="apidoc.element.atlasboard.widget.log">
        function <span class="apidocSignatureSpan">atlasboard.widget.</span>log
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (req, res){
  res.render(path.join(__dirname, &#x22;../..&#x22;, &#x22;templates&#x22;, &#x22;dashboard-log.ejs&#x22;));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### Logging from your job:

```
module.exports = function(config, dependencies, job_callback) {
var text = &#x22;Hello World!&#x22;;

var logger = dependencies.logger;
logger.<span class="apidocCodeKeywordSpan">log</span>(&#x27;I am a log message&#x27;);
logger.trace(&#x27;text is &#x27; + text);
logger.debug(&#x27;text is &#x27; + text);
logger.info(&#x27;I am an info message&#x27;);
logger.warn(&#x27;I am a warning message&#x27;);
logger.error(&#x27;this is an error!&#x27;)

job_callback(null, {title: config.widgetTitle, text: text});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.widget.renderHtmlWidget" id="apidoc.element.atlasboard.widget.renderHtmlWidget">
        function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderHtmlWidget
        <span class="apidocSignatureSpan">(packagesPath, widgetName, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderHtmlWidget = function (packagesPath, widgetName, req, res){

  widgetName = getSafeItemName(widgetName);

  function getFileContents (extension, cb){
    itemManager.getFirst(packagesPath, widgetName, &#x22;widgets&#x22;, extension, function (err, path) {
      if (err || !path) {
        return cb(err ? err : &#x27;File does not exist&#x27;);
      }
      fs.readFile(path, &#x27;utf-8&#x27;, cb);
    });
  }

  function loadHTML (res, cb) {
    getFileContents(&#x22;.html&#x22;, function (err, html) {
      if (!err &#x26;&#x26; html) {
        res.write(html);
      }
      cb(err);
    });
  }

  function loadCSSIfPresent (res, cb){
    getFileContents(&#x22;.css&#x22;, function(err, css){
      if (!err &#x26;&#x26; css) {
        addNamespacesCSSToResponse(css, widgetName, res);
      }
      cb(err);
    });
  }

  function loadStylusIfPresent(res, cb) {
    getFileContents(&#x22;.styl&#x22;, function(err, stylusContent){
      if (!err &#x26;&#x26; stylusContent) {
        stylus.getWidgetCSS(stylusContent, function(err, css){
          if (!err) {
            addNamespacesCSSToResponse(css, widgetName, res);
          } else {
            logger.error(err);
          }
          cb(err);
        });
      } else {
        cb(err);
      }
    });
  }

  res.type(&#x22;text/html&#x22;);

  loadStylusIfPresent(res, function(){
    loadCSSIfPresent(res, function(){
      loadHTML(res, function(err){
        if (err) {
          res.status(500).send(&#x22;Error rendering widget: &#x22; + err);
        } else {
          res.end();
        }
      });
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var packagesLocalFolder = path.join(process.cwd(), &#x22;/test/fixtures/package_widget_stylus_support&#x22;);
var packagesAtlasboardFolder = path.join(process.cwd(), &#x22;/packages&#x22;);

describe(&#x27;widget&#x27;, function () {

it(&#x27;should return html and css&#x27;, function (done) {
  widgetRouteLogic.<span class="apidocCodeKeywordSpan">renderHtmlWidget</span>([packagesLocalFolder, packagesAtlasboardFolder], &#
x22;blockers&#x22;,
      {}, responseHelpers.getResponseWriteEnd([&#x22;body&#x22;, &#x22;&#x3c;style&#x3e;&#x22;, &#x22;font-family: Comics Sans;&#
x22;], &#x22;text/html&#x22;, done));
});

it(&#x27;should return html and stylus&#x27;, function (done) {
  widgetRouteLogic.renderHtmlWidget([packagesLocalFolder, packagesAtlasboardFolder], &#x22;blockers_only_stylus&#x22;,
      {}, responseHelpers.getResponseWriteEnd([&#x22;body&#x22;, &#x22;&#x3c;style&#x3e;&#x22;, &#x22;font-family: Arial&#x22;], &#
x22;text/html&#x22;, done));
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.widget.renderJsWidget" id="apidoc.element.atlasboard.widget.renderJsWidget">
        function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderJsWidget
        <span class="apidocSignatureSpan">(packagesPath, widgetName, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderJsWidget = function (packagesPath, widgetName, req, res){
  res.type(&#x22;application/javascript&#x22;);
  widgetName = getSafeItemName(widgetName);
  itemManager.getFirst(packagesPath, widgetName, &#x22;widgets&#x22;, &#x22;.js&#x22;, function(err, jsFile){
    if (err || !jsFile){
      var msg = err ? err : &#x27;JS file not found for widget &#x27; + widgetName;
      logger.error(msg)
      res.status(400).send(&#x22;Error rendering widget: &#x22; + msg);
    } else {
      res.sendFile(jsFile);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x27;should return resource if path is correct&#x27;, function (done) {
  widgetRouteLogic.renderWidgetResource(localPackagesPath, &#x27;otherpackage1/blockers/resource.txt&#x27;,
      {}, responseHelpers.getResponseForSendFile(&#x27;resource.txt&#x27;, done));
});

it(&#x27;return javascript assets for a certain widget&#x27;, function (done) {
  widgetRouteLogic.<span class="apidocCodeKeywordSpan">renderJsWidget</span>([packagesLocalFolder, packagesAtlasboardFolder], &#
x22;blockers&#x22;, {},
      responseHelpers.getResponseForSendFile(&#x22;widgets/blockers/blockers.js&#x22;, done));
});

it(&#x27;ignore path prefix - prevent path traversal issues&#x27;, function (done) {
  widgetRouteLogic.renderJsWidget([packagesLocalFolder, packagesAtlasboardFolder], &#x22;../../blockers&#x22;, {},
      responseHelpers.getResponseForSendFile(&#x22;widgets/blockers/blockers.js&#x22;, done));
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.atlasboard.widget.renderWidgetResource" id="apidoc.element.atlasboard.widget.renderWidgetResource">
        function <span class="apidocSignatureSpan">atlasboard.widget.</span>renderWidgetResource
        <span class="apidocSignatureSpan">(localPackagesPath, resource, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderWidgetResource = function (localPackagesPath, resource, req, res){
  if (!resource){
    return res.status(400).send(&#x27;resource id not specified&#x27;);
  }
  //sanitization
  var input = resource.split(&#x27;/&#x27;);
  if (input.length !== 3) {
    return res.status(400).send(&#x27;bad input&#x27;);
  }
  var packageName = input[0];
  var widgetName = input[1];
  var resourceName = input[2];

  //TODO: add extra sanitization
  var resourcePath = path.join(localPackagesPath, packageName, &#x27;widgets&#x27;, widgetName, resourceName);
  if (fs.existsSync(resourcePath)){
    res.sendFile(resourcePath);
  }
  else {
    return res.status(404).send(&#x27;resource not found&#x27;);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});

describe(&#x27;widget resources&#x27;, function () {

var localPackagesPath = path.join(process.cwd(), &#x27;test&#x27;, &#x27;fixtures&#x27;, &#x27;packages&#x27;);

it(&#x27;should return 400 if resource input is undefined&#x27;, function (done) {
  widgetRouteLogic.<span class="apidocCodeKeywordSpan">renderWidgetResource</span>(localPackagesPath, undefined,
      {}, responseHelpers.getResponseForSendStatusCode(400, done));
});

it(&#x27;should return 400 if resource input is empty&#x27;, function (done) {
  widgetRouteLogic.renderWidgetResource(localPackagesPath, &#x27;/&#x27;,
      {}, responseHelpers.getResponseForSendStatusCode(400, done));
});
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
